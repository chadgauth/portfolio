---
const { last_posts=[] } = Astro.props;
import 'caroucssel/styles/caroucssel.min.css'
import { Image } from "astro:assets"
---

<div class="container w-full relative">
    <div transition:name="hero" class="caroucssel use-snap w-full h-full relative">
        {last_posts.map((post: { data: { heroImage: string | null | undefined; title: string; pubDate: unknown; subtitle: unknown; description: unknown; }; slug: string; }, index: any) => (
        <div class="item w-full h-full relative">
            <div class="w-full h-[242px] overflow-hidden">
                {post.data.heroImage && <Image
                    class="h-full w-auto object-cover"
                    width={528}
                    height={264}
                    format="webp"
                    src={post.data.heroImage} 
                    alt={post.data.title} 
                />}
            </div>
            <div class="absolute top-0 bottom-0 px-8 py-4 bg-gradient-to-b from-secondary-700/95 to-background-900/75">
                <div class="text-accent-50 text-2xl font-bold leading-snug line-clamp-1">{post.data.title}</div>
                <div class="text-lg text-accent-100 leading-snug line-clamp-1">{post.data.subtitle}</div>
                <div class="pt-3 text-background-200 text-sm line-clamp-2">{post.data.description}</div>
            </div>
            <a class="absolute bottom-4 right-8" href={"/blog/" + post.slug}>
                <button class="custom-btn btn"><span>Read More</span></button>
                
            </a>
             
            <span class="absolute bottom-4 left-8 text-text-100">{post.data.pubDate instanceof Date ? 
    new Date(post.data.pubDate).toLocaleString('en-US', { month: 'short', day: 'numeric', year: '2-digit' }) 
    : 'Invalid Date'}</span>
        </div>
        ))}
    </div> 
</div>

<style is:global>
    .arrows {
        position: absolute;
        top: 50%;
        transform: translateY(-50%) scaleY(1.4) scaleX(.9);
        transition: .1s opacity ease-out;
    }    
    .arrows[disabled] {
        opacity: .3;
    }
    .next-arrow {
        right: .3rem;
    }
    .prev-arrow {
        left: .3rem;
    }

.custom-btn {
  width: 100px;
  height: 40px;
  border-radius: 2px;
  padding: 10px 25px;
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  display: inline-block;
   box-shadow:inset 2px 2px 2px 0px rgba(255,255,255,.5),
   7px 7px 20px 0px rgba(0,0,0,.1),
   4px 4px 5px 0px rgba(0,0,0,.1);
  outline: none;
}

    .btn {
  width: 100px;
  height: 40px;
  line-height: 42px;
  padding: 0;
  border: none;
  background: theme('colors.accent.600');
  background: linear-gradient(0deg, theme('colors.accent.600'), theme('colors.primary.600'));
}
.btn:hover {
  color: theme('colors.text.100');
  background: theme('colors.accent.600');
   box-shadow:none;
}
.btn:before,
.btn:after{
  content:'';
  position:absolute;
  top:0;
  right:0;
  height:2px;
  width:0;
  background: theme('colors.accent.500');
  box-shadow:
   -1px -1px 5px 0px #fff,
   7px 7px 20px 0px #0003,
   4px 4px 5px 0px #0002;
  transition:400ms ease all;
}
.btn:after{
  right:inherit;
  top:inherit;
  left:0;
  bottom:0;
}
.btn:hover:before,
.btn:hover:after{
  width:100%;
  transition:800ms ease all;
}
</style>

<script>
import { Carousel } from 'caroucssel';
import { Buttons } from 'caroucssel/features/buttons';
import { Mouse } from 'caroucssel/features/mouse';
import { Pagination } from 'caroucssel/features/pagination';

function setupCarousel() {
    var element = document.querySelector('.caroucssel');
var items = Array.from(document.querySelectorAll('.item'));

if (!element) {
    throw new Error('Missing element for carousel.');
}
    new Carousel(element, {
        features: [
            new Buttons({
                className: 'arrows',
                nextClassName: 'next-arrow',
                nextTitle: 'Click this button to go one step forward',
                nextLabel: '>',
                previousClassName: 'prev-arrow',
                previousTitle: 'Click this button to go one step back',
                previousLabel: '<',
                template: ({ className, label, title }) =>
                    `<button class="${className} text-3xl text-primary-400" title="${title}">
            ${label}
            </button>`,
            }),
            new Mouse(),
        ],
        onScroll: function (event) {
            items.forEach(function (item, index) {
                item.classList[event.index.includes(index) ? 'add' : 'remove']('is-active');
            });
        }
    });
}


document.addEventListener('astro:page-load', () => {
    // This only runs once.
    setupCarousel();
  });
</script>